ui = true
cluster_name = "{{ vault_cluster_name }}"

storage "raft" {
  path = "/opt/vault/data"
  node_id = "{{ inventory_hostname }}"
  
  {% for host in groups['vault_servers'] %}
  {% if host != inventory_hostname %}
  retry_join {
    leader_api_addr = "https://{{ hostvars[host]['ansible_host'] }}:8200"
  }
  {% endif %}
  {% endfor %}
}

listener "tcp" {
  address = "{{ ansible_host }}:8200"
  tls_cert_file = "/etc/vault.d/vault.crt"
  tls_key_file = "/etc/vault.d/vault.key"
}

api_addr = "https://{{ ansible_host }}:8200"
cluster_addr = "https://{{ ansible_host }}:8201"